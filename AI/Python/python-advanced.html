<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Python高级 | Snake8859</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/snake.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="Snake8859的文档和个人笔记">
    <link rel="preload" href="/assets/css/0.styles.096ead02.css" as="style"><link rel="preload" href="/assets/js/app.02e74a2b.js" as="script"><link rel="preload" href="/assets/js/2.57c6d2f7.js" as="script"><link rel="preload" href="/assets/js/34.cb778d11.js" as="script"><link rel="prefetch" href="/assets/js/10.c2699515.js"><link rel="prefetch" href="/assets/js/100.e57e7729.js"><link rel="prefetch" href="/assets/js/101.baa01a63.js"><link rel="prefetch" href="/assets/js/102.1453dcb5.js"><link rel="prefetch" href="/assets/js/103.48c119dd.js"><link rel="prefetch" href="/assets/js/104.550d240d.js"><link rel="prefetch" href="/assets/js/105.b1180861.js"><link rel="prefetch" href="/assets/js/106.c5ccb84e.js"><link rel="prefetch" href="/assets/js/107.9682dff2.js"><link rel="prefetch" href="/assets/js/108.f1e82505.js"><link rel="prefetch" href="/assets/js/109.3598962f.js"><link rel="prefetch" href="/assets/js/11.53f16f31.js"><link rel="prefetch" href="/assets/js/110.15fe31e1.js"><link rel="prefetch" href="/assets/js/111.a0b10664.js"><link rel="prefetch" href="/assets/js/112.d3939d20.js"><link rel="prefetch" href="/assets/js/113.46e4835a.js"><link rel="prefetch" href="/assets/js/114.e55e2fb3.js"><link rel="prefetch" href="/assets/js/115.e06faf79.js"><link rel="prefetch" href="/assets/js/12.3c132a0b.js"><link rel="prefetch" href="/assets/js/13.41791305.js"><link rel="prefetch" href="/assets/js/14.cc4eaec7.js"><link rel="prefetch" href="/assets/js/15.4f4f189f.js"><link rel="prefetch" href="/assets/js/16.af6aed74.js"><link rel="prefetch" href="/assets/js/17.c8762897.js"><link rel="prefetch" href="/assets/js/18.c5dc67b3.js"><link rel="prefetch" href="/assets/js/19.86d202ed.js"><link rel="prefetch" href="/assets/js/20.e4189130.js"><link rel="prefetch" href="/assets/js/21.c7811963.js"><link rel="prefetch" href="/assets/js/22.d82eb4ed.js"><link rel="prefetch" href="/assets/js/23.5548e03a.js"><link rel="prefetch" href="/assets/js/24.8aad1281.js"><link rel="prefetch" href="/assets/js/25.356cd371.js"><link rel="prefetch" href="/assets/js/26.0a3dcd9a.js"><link rel="prefetch" href="/assets/js/27.08050082.js"><link rel="prefetch" href="/assets/js/28.fb22042e.js"><link rel="prefetch" href="/assets/js/29.03fccaf0.js"><link rel="prefetch" href="/assets/js/3.bde541ac.js"><link rel="prefetch" href="/assets/js/30.60a56dab.js"><link rel="prefetch" href="/assets/js/31.987d12a2.js"><link rel="prefetch" href="/assets/js/32.1adb2c8c.js"><link rel="prefetch" href="/assets/js/33.2108f876.js"><link rel="prefetch" href="/assets/js/35.bbf509e8.js"><link rel="prefetch" href="/assets/js/36.4378233a.js"><link rel="prefetch" href="/assets/js/37.0ae1fe21.js"><link rel="prefetch" href="/assets/js/38.51659462.js"><link rel="prefetch" href="/assets/js/39.26983312.js"><link rel="prefetch" href="/assets/js/4.de92bf2f.js"><link rel="prefetch" href="/assets/js/40.e7ac011c.js"><link rel="prefetch" href="/assets/js/41.b38b59a9.js"><link rel="prefetch" href="/assets/js/42.f13536bc.js"><link rel="prefetch" href="/assets/js/43.20016372.js"><link rel="prefetch" href="/assets/js/44.df5cefde.js"><link rel="prefetch" href="/assets/js/45.7f2bd9f7.js"><link rel="prefetch" href="/assets/js/46.6572ecd2.js"><link rel="prefetch" href="/assets/js/47.29c01931.js"><link rel="prefetch" href="/assets/js/48.c5d50761.js"><link rel="prefetch" href="/assets/js/49.eedeb413.js"><link rel="prefetch" href="/assets/js/5.d35fae6e.js"><link rel="prefetch" href="/assets/js/50.668aed89.js"><link rel="prefetch" href="/assets/js/51.fabbb73f.js"><link rel="prefetch" href="/assets/js/52.40199eb6.js"><link rel="prefetch" href="/assets/js/53.04341370.js"><link rel="prefetch" href="/assets/js/54.1ea7a647.js"><link rel="prefetch" href="/assets/js/55.d9a29e16.js"><link rel="prefetch" href="/assets/js/56.5a212b0d.js"><link rel="prefetch" href="/assets/js/57.557b132e.js"><link rel="prefetch" href="/assets/js/58.57f63c23.js"><link rel="prefetch" href="/assets/js/59.f9868ad9.js"><link rel="prefetch" href="/assets/js/6.cbbecb9e.js"><link rel="prefetch" href="/assets/js/60.d715511d.js"><link rel="prefetch" href="/assets/js/61.94f23e53.js"><link rel="prefetch" href="/assets/js/62.b9d0cd87.js"><link rel="prefetch" href="/assets/js/63.430b0804.js"><link rel="prefetch" href="/assets/js/64.64115894.js"><link rel="prefetch" href="/assets/js/65.862c29a4.js"><link rel="prefetch" href="/assets/js/66.1d742c87.js"><link rel="prefetch" href="/assets/js/67.85f2fac8.js"><link rel="prefetch" href="/assets/js/68.5433d095.js"><link rel="prefetch" href="/assets/js/69.4e1e27a1.js"><link rel="prefetch" href="/assets/js/7.58204c03.js"><link rel="prefetch" href="/assets/js/70.5ea3a9d1.js"><link rel="prefetch" href="/assets/js/71.76670aca.js"><link rel="prefetch" href="/assets/js/72.709e8ea7.js"><link rel="prefetch" href="/assets/js/73.36be2c03.js"><link rel="prefetch" href="/assets/js/74.3846c884.js"><link rel="prefetch" href="/assets/js/75.7645483b.js"><link rel="prefetch" href="/assets/js/76.fd3c307b.js"><link rel="prefetch" href="/assets/js/77.7be1ab20.js"><link rel="prefetch" href="/assets/js/78.32ab0068.js"><link rel="prefetch" href="/assets/js/79.efbbf8ab.js"><link rel="prefetch" href="/assets/js/8.abd032fa.js"><link rel="prefetch" href="/assets/js/80.9f10b4c0.js"><link rel="prefetch" href="/assets/js/81.451f32ee.js"><link rel="prefetch" href="/assets/js/82.722cb36d.js"><link rel="prefetch" href="/assets/js/83.f9528af6.js"><link rel="prefetch" href="/assets/js/84.47c73bff.js"><link rel="prefetch" href="/assets/js/85.b01e8c4a.js"><link rel="prefetch" href="/assets/js/86.c88eff6b.js"><link rel="prefetch" href="/assets/js/87.870c1ca3.js"><link rel="prefetch" href="/assets/js/88.1096db0d.js"><link rel="prefetch" href="/assets/js/89.9cc7fb66.js"><link rel="prefetch" href="/assets/js/9.5bf26188.js"><link rel="prefetch" href="/assets/js/90.e1df3db6.js"><link rel="prefetch" href="/assets/js/91.b58c4d10.js"><link rel="prefetch" href="/assets/js/92.f969419b.js"><link rel="prefetch" href="/assets/js/93.8490ac72.js"><link rel="prefetch" href="/assets/js/94.7d04723c.js"><link rel="prefetch" href="/assets/js/95.953295d7.js"><link rel="prefetch" href="/assets/js/96.4523f191.js"><link rel="prefetch" href="/assets/js/97.1f861b1b.js"><link rel="prefetch" href="/assets/js/98.86252b38.js"><link rel="prefetch" href="/assets/js/99.6c922fe1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.096ead02.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Snake8859</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专业" class="dropdown-title"><span class="title">专业</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          地信
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Introduction/" class="nav-link">
  地信导论和原理
</a></li><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Operation/" class="nav-link">
  地信软件操作
</a></li><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Programming/" class="nav-link">
  地信编程
</a></li><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Resources/" class="nav-link">
  地信资源
</a></li></ul></li><li class="dropdown-item"><h4>
          遥感
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Major/RS/RS_Introduction/" class="nav-link">
  遥感导论和原理
</a></li><li class="dropdown-subitem"><a href="/Major/RS/RS_Operation/" class="nav-link">
  遥感软件操作
</a></li><li class="dropdown-subitem"><a href="/Major/RS/RS_Programming/" class="nav-link">
  遥感编程
</a></li><li class="dropdown-subitem"><a href="/Major/RS/RS_Resources/" class="nav-link">
  遥感资源
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><span class="title">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/HTML_CSS_JS/" class="nav-link">
  HTML/CSS/JS
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Vuejs/" class="nav-link">
  Vuejs/Dojo
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/MiniProgram/" class="nav-link">
  微信小程序
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/Java/" class="nav-link">
  Java
</a></li><li class="dropdown-subitem"><a href="/BackEnd/DataBase/" class="nav-link">
  数据库
</a></li><li class="dropdown-subitem"><a href="/BackEnd/WebServer/" class="nav-link">
  Web服务器
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/AI/Python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/EnvsAndTools/" class="nav-link">
  开发环境与工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="研究" class="dropdown-title"><span class="title">研究</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AI/DIP/" class="nav-link">
  数字图像处理
</a></li><li class="dropdown-item"><!----> <a href="/AI/PR/" class="nav-link">
  模式识别导论
</a></li><li class="dropdown-item"><!----> <a href="/AI/MachineLearning/" class="nav-link">
  机器学习
</a></li><li class="dropdown-item"><!----> <a href="/AI/DeepLearning/" class="nav-link">
  深度学习
</a></li></ul></div></div><div class="nav-item"><a href="/LifeAndTC/" class="nav-link">
  生活与吐槽
</a></div><div class="nav-item"><a href="/About/" class="nav-link">
  关于
</a></div> <a href="https://github.com/Snake8859/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专业" class="dropdown-title"><span class="title">专业</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          地信
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Introduction/" class="nav-link">
  地信导论和原理
</a></li><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Operation/" class="nav-link">
  地信软件操作
</a></li><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Programming/" class="nav-link">
  地信编程
</a></li><li class="dropdown-subitem"><a href="/Major/GIS/GIS_Resources/" class="nav-link">
  地信资源
</a></li></ul></li><li class="dropdown-item"><h4>
          遥感
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Major/RS/RS_Introduction/" class="nav-link">
  遥感导论和原理
</a></li><li class="dropdown-subitem"><a href="/Major/RS/RS_Operation/" class="nav-link">
  遥感软件操作
</a></li><li class="dropdown-subitem"><a href="/Major/RS/RS_Programming/" class="nav-link">
  遥感编程
</a></li><li class="dropdown-subitem"><a href="/Major/RS/RS_Resources/" class="nav-link">
  遥感资源
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><span class="title">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/HTML_CSS_JS/" class="nav-link">
  HTML/CSS/JS
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Vuejs/" class="nav-link">
  Vuejs/Dojo
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/MiniProgram/" class="nav-link">
  微信小程序
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/Java/" class="nav-link">
  Java
</a></li><li class="dropdown-subitem"><a href="/BackEnd/DataBase/" class="nav-link">
  数据库
</a></li><li class="dropdown-subitem"><a href="/BackEnd/WebServer/" class="nav-link">
  Web服务器
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/AI/Python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/EnvsAndTools/" class="nav-link">
  开发环境与工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="研究" class="dropdown-title"><span class="title">研究</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/AI/DIP/" class="nav-link">
  数字图像处理
</a></li><li class="dropdown-item"><!----> <a href="/AI/PR/" class="nav-link">
  模式识别导论
</a></li><li class="dropdown-item"><!----> <a href="/AI/MachineLearning/" class="nav-link">
  机器学习
</a></li><li class="dropdown-item"><!----> <a href="/AI/DeepLearning/" class="nav-link">
  深度学习
</a></li></ul></div></div><div class="nav-item"><a href="/LifeAndTC/" class="nav-link">
  生活与吐槽
</a></div><div class="nav-item"><a href="/About/" class="nav-link">
  关于
</a></div> <a href="https://github.com/Snake8859/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AI/Python/" class="sidebar-link">大纲</a></li><li><a href="/AI/Python/python-base.html" class="sidebar-link">Python基础</a></li><li><a href="/AI/Python/python-oo.html" class="sidebar-link">Python面向对象</a></li><li><a href="/AI/Python/python-advanced.html" class="active sidebar-link">Python高级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#语法高级" class="sidebar-link">语法高级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#函数的理解" class="sidebar-link">函数的理解</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#with与上下文管理器" class="sidebar-link">with与上下文管理器</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#装饰器" class="sidebar-link">装饰器</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#迭代器" class="sidebar-link">迭代器</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#生成器" class="sidebar-link">生成器</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#元类" class="sidebar-link">元类</a></li></ul></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#异常机制" class="sidebar-link">异常机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#异常与异常处理" class="sidebar-link">异常与异常处理</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#自定义异常类" class="sidebar-link">自定义异常类</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#主动抛出异常" class="sidebar-link">主动抛出异常</a></li></ul></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#多任务" class="sidebar-link">多任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#进程" class="sidebar-link">进程</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#线程" class="sidebar-link">线程</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#协程" class="sidebar-link">协程</a></li></ul></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#网络编程" class="sidebar-link">网络编程</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#数据库操作" class="sidebar-link">数据库操作</a></li><li class="sidebar-sub-header"><a href="/AI/Python/python-advanced.html#常用第三方模块" class="sidebar-link">常用第三方模块</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="python高级"><a href="#python高级" class="header-anchor">#</a> Python高级</h1> <h2 id="语法高级"><a href="#语法高级" class="header-anchor">#</a> 语法高级</h2> <h3 id="函数的理解"><a href="#函数的理解" class="header-anchor">#</a> 函数的理解</h3> <p>函数是任何语言重要组成部分，在Python基础里已经对函数的基本用法介绍了，在这里再次引出，加深对函数的理解。</p> <ul><li><p><strong>函数与对象</strong></p> <p>在Python里万物皆对象，函数其实也是对象的一种表现形式，函数作为对象可以赋值给一个变量，可以放在集合容器中，可以作为参数传递，作为函数返回值。</p></li> <li><p><strong>函数作为变量，函数作为参数，函数作为返回值</strong></p> <ol><li><p>函数作为变量</p> <p>函数作为一个对象变量，具有id，类型和值三个基本属性</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>fun<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>fun<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fun<span class="token punctuation">)</span>

<span class="token number">83001416</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'function'</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>function fun at <span class="token number">0x0000000004F28048</span><span class="token operator">&gt;</span>
</code></pre></div><p>函数作为一个对象变量可以赋值给一个变量</p> <div class="language-python extra-class"><pre class="language-python"><code>f1 <span class="token operator">=</span> fun
f1<span class="token punctuation">(</span><span class="token string">'snake8859-fun'</span><span class="token punctuation">)</span>
</code></pre></div><p>说明：赋值给另外一个变量时，函数并不会被调用，仅仅是在函数对象上绑定一个新的名字而已。</p> <p><img src="/AI/Python/%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E5%8F%98%E9%87%8F.jpg" alt="函数作为变量"></p></li> <li><p>函数作为参数</p> <p>函数可以作为参数传递给另一个函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    size <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token string">&quot;snake8859-show&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 等效于 fun(&quot;snake8859-show&quot;) </span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&quot;length of string is : %s&quot;</span> <span class="token operator">%</span> size<span class="token punctuation">)</span>

show<span class="token punctuation">(</span>fun<span class="token punctuation">)</span>

length of string <span class="token keyword">is</span> <span class="token punctuation">:</span> <span class="token number">14</span>
</code></pre></div></li> <li><p>函数作为返回值</p> <p>函数还可以作为另一个函数的返回值</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> fun

f <span class="token operator">=</span> hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>
size <span class="token operator">=</span> f<span class="token punctuation">(</span><span class="token string">'snake8859-hidden'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token comment">#16</span>

<span class="token comment">#或者可以简写为</span>
size1 <span class="token operator">=</span> hidden<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'snake8859-hidden'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>size1<span class="token punctuation">)</span> <span class="token comment">#16</span>
</code></pre></div><p>函数接受一个或多个函数作为输入或者函数输出（返回）的值是函数时，我们称这样的函数为高阶函数，比如上面的show和hidden都属于高阶函数。</p> <p>Python内置函数中，典型的高阶函数是 map 函数，map 接受一个函数和一个迭代对象作为参数，调用 map 时，依次迭代把迭代对象的元素作为参数调用该函数。</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
 
 lens <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span>fun<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;snake&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;8859&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>lens<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
 <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
</code></pre></div></li></ol></li> <li><p><strong>__call__</strong></p> <p>类也能作为函数，对于一个自定义的类，如果实现了<code>__call__</code>方法，那么该类的实例对象的行为就是一个函数，是一个可以被调用（callable)的对象。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Add</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
         self<span class="token punctuation">.</span>n <span class="token operator">=</span> n
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>n <span class="token operator">+</span> x

add5 <span class="token operator">=</span> Add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>add5<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#6</span>
</code></pre></div><p>说明：执行 add5(1) 相当于调用 Add.<em>call</em>_(add, 1)，self 就是实例对象 add，self.n 等于 5，所以返回值为 1+5</p> <p>注意：确定对象是否为可调用对象可以用内置函数callable来判断。</p></li></ul> <p>更多具体详细内容参考<a href="https://foofish.net/function-is-first-class-object.html" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="with与上下文管理器"><a href="#with与上下文管理器" class="header-anchor">#</a> with与上下文管理器</h3> <ul><li><p><strong>with</strong></p> <p>在python中对于系统资源如文件，数据库连接，socket等而言，在代码打开这些资源完成业务逻辑后，必须要做的一件事就是关闭（断开）资源。</p> <p>如打开和关闭的文件的情况。</p> <h5 id="普通版"><a href="#普通版" class="header-anchor">#</a> 普通版</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;output.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;python之禅&quot;</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>问题：调用 write 的过程中，出现了异常进而导致后续代码无法继续执行，close 方法无法被正常调用，因此资源就会一直被该程序占用者释放。</p> <h5 id="进阶版"><a href="#进阶版" class="header-anchor">#</a> 进阶版</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;output.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;python之禅&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> IOError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;oops error&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>改良：可能发生异常的代码处进行 try 捕获，使用 try/finally 语句，该语句表示如果在 try 代码块中程序出现了异常，后续代码就不再执行，而直接跳转到 except 代码块。而无论如何，finally 块的代码最终都会被执行。但是写起来比较啰嗦。</p> <h5 id="终极版"><a href="#终极版" class="header-anchor">#</a> 终极版</h5> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">m3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;output.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;Python之禅&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>一种更加简洁、优雅的方式就是用 with 关键字。open 方法的返回值赋值给变量 f，当离开 with 代码块的时候，系统会自动调用 f.close() 方法。</p></li> <li><p><strong>上下文管理器</strong></p> <p>with关键字实现原理，就是利用上下文管理器。任何实现了 <code>__enter__()</code> 和 <code>__exit__()</code> 方法的对象都可称之为上下文管理器。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>filename <span class="token operator">=</span> filename
        self<span class="token punctuation">.</span>mode <span class="token operator">=</span> mode

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;entering&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> self<span class="token punctuation">.</span>mode<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>f

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;will exit&quot;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
       
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> File<span class="token punctuation">(</span><span class="token string">'out.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;writing&quot;</span><span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'hello, python'</span><span class="token punctuation">)</span>
</code></pre></div><p><code>__enter__()</code> 方法返回资源对象，如打开资源。</p> <p><code>__exit__()</code>方法处理善后工作，如关闭资源。</p> <p>这样，就无需显示地调用 close 方法了，由系统自动去调用，哪怕中间遇到异常 close 方法也会被调用。</p></li></ul> <h3 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h3> <ul><li><p><strong>什么是闭包</strong></p> <p>我们知道在函数中定义的变量是局部变量，局部变量的作用域在函数内部，出了函数内部就不能再引用了。</p> <p>定义在模块最外层的变量是全局变量，全局变量作用域是整个文件，在文件任何地方都能被引用。</p> <p>在之前也知道了，函数内部可以定义另一个函数，即嵌套定义函数。</p> <p>现在考虑一个实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">print_msg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># print_msg 是外围函数</span>
    msg <span class="token operator">=</span> <span class="token string">&quot;snake8859-closure&quot;</span>
    <span class="token keyword">def</span> <span class="token function">printer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># printer 是嵌套函数</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">return</span> printer

c1 <span class="token operator">=</span> print_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>

c1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 输出 snake8859-closure</span>
</code></pre></div><p>可以看到我们在<code>print_msg</code>函数中定义<code>printer</code>函数，并将其作为函数返回值返回。</p> <p>一般情况下，函数中的局部变量仅在函数的执行期间可用，一旦 <code>print_msg()</code> 执行过后，我们会认为 <code>msg</code>变量将不再可用。然而，在这里我们发现 <code>print_msg</code>执行完之后，在调用 c1的时候 <code>msg</code>变量的值正常输出了，这就是闭包的作用，闭包使得局部变量在函数外被访问成为可能。</p> <p>这里的 c1就是一个闭包，闭包本质上是一个函数，它有两部分组成，<code>printer</code> 函数和变量 <code>msg</code>。闭包使得这些变量的值始终保存在内存中。</p> <p>闭包，顾名思义，就是一个封闭的包裹，里面包裹着自由变量，就像在类里面定义的属性值一样，自由变量的可见范围随同包裹，哪里可以访问到这个包裹，哪里就可以访问到这个自由变量。</p></li> <li><p><strong>为什么要用闭包</strong></p> <p>闭包避免了使用全局变量，此外，闭包允许将函数与其所操作的某些数据（环境）关连起来。这一点与面向对象编程是非常类似的，在面对象编程中，对象允许我们将某些数据（对象的属性）与一个或者多个方法相关联。</p> <p>一般来说，当对象中只有一个方法时，这时使用闭包是更好的选择，因为创建对象需要消耗资源比直接使用闭包要多，在此情况下，考虑使用闭包可以节省资源的浪费。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">liner</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> a<span class="token operator">*</span>x<span class="token operator">+</span>b
    <span class="token keyword">return</span> fun

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    fun <span class="token operator">=</span> liner<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
    y <span class="token operator">=</span> fun<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment">#3</span>
</code></pre></div></li></ul> <p>更多具体详细内容参考<a href="https://foofish.net/python-closure.html" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="装饰器"><a href="#装饰器" class="header-anchor">#</a> 装饰器</h3> <ul><li><p><strong>什么是装饰器</strong></p> <p>在解释装饰器前，我们要知道，在python中，函数是可以像普通变量一样作为参数传递给另外一个参数。</p> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    func<span class="token punctuation">(</span><span class="token punctuation">)</span>

bar<span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
</code></pre></div><p>装饰器用于在代码执行期间对其他函数或类增加（增强）额外功能。它经常用于面向切面编程的场景，比如插入日志，事务处理，性能测试和权限校验等。使用装饰器后，能减少重复代码，增加代码的重用性。</p> <p>现在有一个<code>foo()</code>方法，我们想在执行函数时，并记录下函数的执行日志，于是在函数中添加日志代码</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'i am foo'</span><span class="token punctuation">)</span>
    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;foo is running&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>但是如果有foo1,foo2等其他函数也有这种需要的话，那么也要再其函数中添加日志代码，这样一来造成了大量的代码冗余。为了减少这种冗余，我们可以定义函数，专门处理日志，处理完成后再执行函数。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
    func<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'i am foo'</span><span class="token punctuation">)</span>

use_logging<span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
</code></pre></div><p>目前，似乎以这样方式解决了问题。但是存在一个问题，这样使用破坏了代码的原始结构，我们原本必须把<code>foo</code>函数作为参数，然后再调用<code>use_logging(foo)</code>方法，这样一来在代码可读性上就打了折扣。</p> <p>为了解决这个问题，装饰器应运而生，我们再修改函数定义。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 把 foo 当做参数传递进来时，执行func()就相当于执行foo()</span>
    <span class="token keyword">return</span> wrapper

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'i am foo'</span><span class="token punctuation">)</span>

foo <span class="token operator">=</span> use_logging<span class="token punctuation">(</span>foo<span class="token punctuation">)</span>  <span class="token comment"># 因为装饰器 use_logging(foo) 返回的时函数对象 wrapper，这条语句相当于 foo = wrapper</span>
foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                   <span class="token comment"># 执行foo()就相当于执行 wrapper()</span>
</code></pre></div><p>在执行<code>foo = use_logging(foo)</code>后，左边的foo函数变量作为参数传入use_logging函数中，此时func指向foo，然后use_logging函数返回值为warpper函数对象，此时右边的foo函数变量指向warpper。当执行foo函数时，相当于执行wrappe函数，在wrapper函数中先执行日志记录语句，然后执行func函数，由于func指向foo函数，即执行foo函数，然后结束。</p> <p>那么use_logging(func)就是一个装饰器，所以可以看出装饰其实也是一个普通函数，它把真正业务逻辑函数func包裹其中，在函数执行前后增强其功能。这样子的编程方式被称为面向切面编程。</p> <p>最后，我们可以通过Python里@符号，再省略赋值<code>foo = use_logging(foo)</code>这步操作。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@use_logging</span> <span class="token comment">#相当于执行了use_logging(foo)</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am foo&quot;</span><span class="token punctuation">)</span>

foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>这样，就是装饰器最后的样子。在我们执行函数前，使用@XXX来为函数加上装饰器，然后我们再执行装饰器装饰完成后函数，而不用重复修改函数内容，以这样的方式提高了程序的重用性和可读性。</p></li> <li><p><strong>装饰器情况</strong></p> <ol><li><p>无参数，无返回值函数的装饰器</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@use_logging</span> <span class="token comment">#相当于执行了use_logging(foo)</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am foo&quot;</span><span class="token punctuation">)</span>

foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#foo is running</span>
<span class="token comment">#i am foo</span>
</code></pre></div></li> <li><p>有1至多个参数，无返回值函数的装饰器</p> <p>1个参数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        func<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@use_logging</span> <span class="token comment">#相当于执行了use_logging(foo)</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am %s&quot;</span><span class="token operator">%</span>name<span class="token punctuation">)</span>

foo<span class="token punctuation">(</span><span class="token string">'snake8859'</span><span class="token punctuation">)</span>

<span class="token comment">#foo is running</span>
<span class="token comment">#i am snake8859</span>
</code></pre></div><p>多个参数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        func<span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@use_logging</span> <span class="token comment">#相当于执行了use_logging(foo)</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am %s&quot;</span><span class="token operator">%</span>name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>

foo<span class="token punctuation">(</span><span class="token string">'snake8859'</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>

<span class="token comment">#foo is running</span>
<span class="token comment">#i am snake8859</span>
<span class="token comment">#(11, 22)</span>
<span class="token comment">#{'age': 22}</span>
</code></pre></div></li> <li><p>有1至多个参数，有返回值函数的装饰器</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@use_logging</span> <span class="token comment">#相当于执行了use_logging(foo)</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am %s&quot;</span><span class="token operator">%</span>name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'done'</span>

msg <span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token string">'snake8859'</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

<span class="token comment"># foo is running</span>
<span class="token comment"># i am snake8859</span>
<span class="token comment"># (11, 22)</span>
<span class="token comment"># {'age': 22}</span>
<span class="token comment"># done</span>
</code></pre></div></li> <li><p>多个装饰器修饰同一函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test1</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---test1---'</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---test1正在装饰---'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token keyword">def</span> <span class="token function">test2</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---test2---'</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---test2正在装饰---'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@test1</span>
<span class="token decorator annotation punctuation">@test2</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am foo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'done'</span>

msg <span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

<span class="token comment">#---test2---</span>
<span class="token comment">#---test1---</span>
<span class="token comment">#---test1正在装饰---</span>
<span class="token comment">#---test2正在装饰---</span>
<span class="token comment">#i am foo</span>
<span class="token comment">#done</span>
</code></pre></div><p>多个装饰器修饰同一函数时，装饰体即（wrapper函数）执行顺序与装饰器使用顺序一致，装饰体外内容执行顺序与装饰器使用顺序相反。</p></li> <li><p>同一装饰器修饰多个函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">use_logging</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is running&quot;</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@use_logging</span> <span class="token comment">#相当于执行了use_logging(foo)</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am %s&quot;</span><span class="token operator">%</span>name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'done'</span>

<span class="token decorator annotation punctuation">@use_logging</span>
<span class="token keyword">def</span> <span class="token function">foo1</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;i am %s&quot;</span><span class="token operator">%</span>name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'done'</span>

msg <span class="token operator">=</span> foo<span class="token punctuation">(</span><span class="token string">'snake8859'</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
msg1 <span class="token operator">=</span> foo1<span class="token punctuation">(</span><span class="token string">'prince'</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span>

<span class="token comment"># foo is running</span>
<span class="token comment"># i am snake8859</span>
<span class="token comment"># (11, 22)</span>
<span class="token comment"># {'age': 22}</span>
<span class="token comment"># done</span>
<span class="token comment"># foo1 is running</span>
<span class="token comment"># i am prince</span>
<span class="token comment"># (11, 22)</span>
<span class="token comment"># {'age': 21}</span>
<span class="token comment"># done</span>
</code></pre></div></li></ol></li></ul> <p>更多更详细的内容，可参考<a href="https://foofish.net/python-decorator.html" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="迭代器"><a href="#迭代器" class="header-anchor">#</a> 迭代器</h3> <p>迭代是访问集合元素的一种方式。迭代器，简单理解，就是一个可以遍历元素的对象，迭代器从第一个元素开始访问，到最后一个元素访问完后结束。</p> <ul><li><p>可迭代对象</p> <p>一般将可以通过<code>for...in...</code>语句迭代读取每一条数据的对象称为可迭代对象，比如list，tuple，set，str等数据类型都是可以利用<code>for...in...</code>迭代取值，这些都是可迭代对象。</p> <p>我们可以利用<code>isinstance</code>方法判断一个对象是否为可迭代对象。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable

<span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>container<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container <span class="token operator">=</span> container

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

mylist <span class="token operator">=</span> MyList<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>mylist<span class="token punctuation">,</span>Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#False</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span>Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>
</code></pre></div></li> <li><p>可迭代对象本质</p> <p>如果观察for循环运行细节，会发现每一次迭代都从可迭代对象中取出一条数据赋给临时变量，然后接着取下一条数据直到迭代到取完所有数据。在这个过程中，应该是某个东西去记录每次访问到第几条数据，这样才能保证取到对应的数据，其实这个某个东西就是迭代器。</p> <p>可迭代对象本质是提供迭代器帮助迭代遍历顺利执行。想要让一个对象成为可迭代对象，需要该对象实现<code>__iter__</code>方法，并在该方法内提供一个该对象的迭代器，那么就可以通过迭代器依次获取对象中每一条数据。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> collections <span class="token keyword">import</span> Iterable

<span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        
	<span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;返回一个迭代器&quot;&quot;&quot;</span>
        <span class="token keyword">pass</span>
    
<span class="token builtin">isinstance</span><span class="token punctuation">(</span>mylist<span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span> <span class="token comment">#True</span>
</code></pre></div><p>说明：一个具备<code>__iter__</code>方法的对象，就是一个可迭代对象。</p></li> <li><p>迭代器的创建</p> <p>既然<code>__iter__</code>方法中要求我们返回一个迭代器，那么迭代器是如何定义的呢？我们可以先看一下如何判断一个对象是否是迭代器，可以使用使用<code>isinstance</code>方法判断一个对象是否为迭代器。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterator

<span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>container<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container <span class="token operator">=</span> container

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

mylist <span class="token operator">=</span> MyList<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>mylist<span class="token punctuation">,</span>Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#False</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#True</span>
</code></pre></div><p>可以看到虽然MyList类实现了<code>__iter__</code>方法，但是仅仅只是可迭代对象，而不是迭代器。要想构造一个迭代器，还需要实现<code>__next__</code>方法，即一个实现了<code>__iter__</code>方法和<code>__next__</code>方法的对象，就是迭代器。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterator

<span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
        自定义可迭代对象
    '''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>container<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container <span class="token operator">=</span> container

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        myIterator <span class="token operator">=</span> MyIterator<span class="token punctuation">(</span>self<span class="token punctuation">.</span>container<span class="token punctuation">)</span>
        <span class="token keyword">return</span> myIterator

<span class="token keyword">class</span> <span class="token class-name">MyIterator</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
        自定义供可迭代对象迭代的迭代器
    '''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>mylist<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>mylist <span class="token operator">=</span> mylist
        <span class="token comment">#用于记录当前访问位置</span>
        self<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>current<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mylist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> self<span class="token punctuation">.</span>mylist<span class="token punctuation">[</span>self<span class="token punctuation">.</span>current<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>current <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">return</span> item
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> StopIteration

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    mylist <span class="token operator">=</span> MyList<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> mylist<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>mylist<span class="token punctuation">)</span><span class="token punctuation">,</span>Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
  
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">5</span>
<span class="token boolean">True</span>
</code></pre></div><p>在可迭代对象的<code>__iter__</code>方法中返回一个迭代器，迭代器的要求是要实现<code>__iter__</code>和<code>__next__</code>方法的类。这样，自定义的可迭代对象就可以利用for循环来迭代。同时可以更加深入了解<code>for item in interable</code>循环的本质，它首先通过<code>iter</code>方法获取可迭代对象的迭代器，然后通过调用迭代器的<code>next</code>方法获取下一个值赋给item，当遇到<code>StopIteration</code>的异常时循环结束。</p> <p>为了减少类的增加，我们可以通过另一种方式实现迭代器，即在可迭代对象中同时实现<code>__iter__</code>和<code>__next__</code>方法，并在<code>__iter__</code>中返回自身引用。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterator

<span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
        自定义可迭代对象
    '''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>container<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container <span class="token operator">=</span> container
        self<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>container<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>current<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> self<span class="token punctuation">.</span>container<span class="token punctuation">[</span>self<span class="token punctuation">.</span>current<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>current <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">return</span> item
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> StopIteration
    
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    mylist <span class="token operator">=</span> MyList<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    mylist<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> mylist<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>mylist<span class="token punctuation">)</span><span class="token punctuation">,</span>Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>迭代器的应用场景</p> <p>迭代器核心是能够不断迭代，获取集合中的元素值，既然python中已经提供了列表，元组，集合等可迭代对象，为什么还要自定义可迭代对象呢？</p> <p>考虑这样的一个问题，如果现在要处理一堆很庞大且具有一定规律的数字集，需要通过迭代数字集获取每一个数字，现有两种方式，第一先创建列表，将所有的数字存放其中，然后进行迭代，第二创建自定义迭代器，在每次迭代时按照一定的规律计算生成。显然第二种更好一些，因为第一种方式存在一个问题就是我们需要先将数据一次性存储下来，这样对内存空间的压力是十分大的，而第二种方式可以不用依赖于一个已有数据集，而是通过实时计算的方式获取，这样可以节省大量的内存（存储）空间。</p> <p>举个例子，比如，数学中有个著名的斐波拉契数列（Fibonacci），数列中第一个数为0，第二个数为1，其后的每一个数都可由前两个数相加得到：</p> <p>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, ...</p> <p>现在我们想要通过for...in...循环来遍历迭代斐波那契数列中的前n个数。那么这个斐波那契数列我们就可以用迭代器来实现，每次迭代都通过数学计算来生成下一个数。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FibIterator</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;斐波那契数列迭代器&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        :param n: int, 指明生成数列的前n个数
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>n <span class="token operator">=</span> n
        <span class="token comment"># current用来保存当前生成到数列中的第几个数了</span>
        self<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># num1用来保存前前一个数，初始值为数列中的第一个数0</span>
        self<span class="token punctuation">.</span>num1 <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># num2用来保存前一个数，初始值为数列中的第二个数1</span>
        self<span class="token punctuation">.</span>num2 <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;被next()函数调用来获取下一个数&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>current <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>n<span class="token punctuation">:</span>
            num <span class="token operator">=</span> self<span class="token punctuation">.</span>num1
            self<span class="token punctuation">.</span>num1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num2 <span class="token operator">=</span> self<span class="token punctuation">.</span>num2<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num1<span class="token operator">+</span>self<span class="token punctuation">.</span>num2
            self<span class="token punctuation">.</span>current <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">return</span> num
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> StopIteration

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;迭代器的__iter__返回自身即可&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> self


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    fib <span class="token operator">=</span> FibIterator<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> fib<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
        

<span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">5</span> <span class="token number">8</span> <span class="token number">13</span> <span class="token number">21</span> <span class="token number">34</span>
</code></pre></div></li></ul> <h3 id="生成器"><a href="#生成器" class="header-anchor">#</a> 生成器</h3> <p>生成器是一类特殊的迭代器，便于记录当前状态，配合<code>next</code>函数可以进行迭代使用。</p> <ul><li><p>生成器的创建</p> <ol><li><p>元组推导式</p> <p>元组推导式是创建生成器方式之一。</p></li></ol> <div class="language-python extra-class"><pre class="language-python"><code> G <span class="token operator">=</span> <span class="token punctuation">(</span> x<span class="token operator">*</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>

 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token comment"># for x in G:</span>
 <span class="token comment">#     print(x)</span>


 <span class="token operator">&lt;</span>generator <span class="token builtin">object</span> <span class="token operator">&lt;</span>genexpr<span class="token operator">&gt;</span> at <span class="token number">0x0000000002834248</span><span class="token operator">&gt;</span>
 <span class="token number">0</span>
 <span class="token number">2</span>
 <span class="token number">4</span>
 <span class="token number">6</span>
 <span class="token number">8</span>
 Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
   File <span class="token string">&quot;01-生成器创建-元组推导式.py&quot;</span><span class="token punctuation">,</span> line <span class="token number">9</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span>
 StopIteration
</code></pre></div><p>G为一个生成器，直接打印即可看到生成器的具体信息，对于生成器，可以使用<code>next</code>函数迭代或者for循环等方式。</p> <ol start="2"><li><p>yield</p> <p>元组推导式并不是常用生成器创建方式，<code>yield</code>比较常用。<code>yield</code>的创建生成器，是通过在原有的迭代器的<code>__next__</code>方法中将每次返回值的return换成yield，那么新定义的函数便不是函数，而是生成器，即只要在函数中有<code>yield</code>关键字的称为生成器。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    current <span class="token operator">=</span> <span class="token number">0</span>
    num1<span class="token punctuation">,</span>num2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>
    <span class="token keyword">while</span> current<span class="token operator">&lt;</span>n<span class="token punctuation">:</span>
        num <span class="token operator">=</span> num1
        num1<span class="token punctuation">,</span>num2 <span class="token operator">=</span> num2<span class="token punctuation">,</span>num1<span class="token operator">+</span>num2
        current <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">yield</span> num
    <span class="token keyword">return</span> <span class="token string">'done'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    F <span class="token operator">=</span> fib<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> F<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
 

<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">&quot;02-生成器创建-yield.py&quot;</span><span class="token punctuation">,</span> line <span class="token number">18</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>F<span class="token punctuation">)</span><span class="token punctuation">)</span>
StopIteration<span class="token punctuation">:</span> done
</code></pre></div><p>说明：</p> <ul><li>yield关键字有两点作用：
<ul><li>保存当前运行状态（断点），然后暂停执行，即将生成器（函数）挂起</li> <li>将yield关键字后面表达式的值作为返回值返回，此时可以理解为起到了return的作用</li></ul></li> <li>可以使用next()函数或者for循环让生成器从断点处继续执行，即唤醒生成器（函数）</li> <li>Python3中的生成器可以使用return返回最终运行的返回值，而Python2中的生成器不允许使用return返回一个返回值（即可以使用return从生成器中退出，但return后不能有任何表达式）</li></ul> <p>除了能够使用<code>next()</code>函数唤醒生成器执行外，还可以通过<code>send()</code>函数来唤醒生成器执行。使用<code>send()</code>函数除了能够唤醒之外，还能向断点处传递一个附加数据。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">G</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> i<span class="token operator">&lt;</span>num<span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token keyword">yield</span> i
        <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
        i <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token string">'done'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    g <span class="token operator">=</span> G<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'bb'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'cc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'dd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'ee'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    
<span class="token number">0</span>
aa
<span class="token number">1</span>
bb
<span class="token number">2</span>
cc
<span class="token number">3</span>
dd
<span class="token number">4</span>
ee
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">&quot;03-生成器唤醒-send.py&quot;</span><span class="token punctuation">,</span> line <span class="token number">16</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'ee'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
StopIteration<span class="token punctuation">:</span> done
</code></pre></div><p>注意：如果第一次执行生成器，尽量用next，要用send的话，就需要传None，因为第一次执行生成器的时候，它还没有到yield语句右边赋值，如果传值会产生异常。</p></li></ol></li></ul> <h3 id="元类"><a href="#元类" class="header-anchor">#</a> 元类</h3> <ul><li><p><strong>使用type创建类</strong></p> <p>在大多数编程语言中，类是用于描述和生成对象的代码段，但是在python中类同样是一种对象，当使用<code>class</code>关键字时，python解释器将会在内存中创建一个对象，这个对象名就是类名，不过这个对象拥有创建对象（实例对象）的能力，但是它本质依然是一个对象。</p> <p>由于类也是对象，所以可以在运行时动态创建类，就像之前创建实例对象时。</p> <p>例如</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">choose_class</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">'foo'</span><span class="token punctuation">:</span>
        <span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">return</span> Foo
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">return</span> Bar

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    Foo <span class="token operator">=</span> choose_class<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
    foo <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>

<span class="token comment"># &lt;class '__main__.choose_class.&lt;locals&gt;.Foo'&gt;</span>
<span class="token comment"># &lt;__main__.choose_class.&lt;locals&gt;.Foo object at 0x0000000002986FC8&gt;</span>
</code></pre></div><p>除了手动编写运行时创建类之外，其实还有种方式可以创建一个类，就是<code>type</code>。</p> <p><code>type</code>可以接受一个类的描述作为参数，然后返回一个类。</p> <p><code>type(类名, 由父类名称组成的元组（针对继承的情况，可以为空），包含属性的字典（名称和值）)</code></p> <ol><li><p>type创建简单类</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token builtin">help</span><span class="token punctuation">(</span>Test1<span class="token punctuation">)</span> <span class="token comment">#查看类详细信息</span>
    test1 <span class="token operator">=</span> Test1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#常规创建类</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>test1<span class="token punctuation">)</span>

    Test2 <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Test2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#type动态创建类</span>
    <span class="token builtin">help</span><span class="token punctuation">(</span>Test2<span class="token punctuation">)</span> <span class="token comment">#查看类详细信息</span>
    test2 <span class="token operator">=</span> Test2<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>test2<span class="token punctuation">)</span>

<span class="token comment">#输出内容</span>
<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Test1 <span class="token builtin">object</span> at <span class="token number">0x0000000002986EC8</span><span class="token operator">&gt;</span>
Help on <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token keyword">in</span> module __main__<span class="token punctuation">:</span>

<span class="token keyword">class</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span>builtins<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">)</span>
 <span class="token operator">|</span>  Data descriptors defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __dict__
 <span class="token operator">|</span>      dictionary <span class="token keyword">for</span> instance variables <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __weakref__
 <span class="token operator">|</span>      <span class="token builtin">list</span> of weak references to the <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>

<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Test2 <span class="token builtin">object</span> at <span class="token number">0x0000000002CF7D88</span><span class="token operator">&gt;</span>
Help on <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token keyword">in</span> module __main__<span class="token punctuation">:</span>

<span class="token keyword">class</span> <span class="token class-name">Test2</span><span class="token punctuation">(</span>builtins<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">)</span>
 <span class="token operator">|</span>  Data descriptors defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __dict__
 <span class="token operator">|</span>      dictionary <span class="token keyword">for</span> instance variables <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __weakref__
 <span class="token operator">|</span>      <span class="token builtin">list</span> of weak references to the <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
</code></pre></div><p>可以看到利用tpye创建的类和之前了解创建类的方式所构成类的信息是一致的。</p></li> <li><p>type创建继承的类</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'ZhangThree'</span>
    age <span class="token operator">=</span> <span class="token number">18</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    Test2 <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Test2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>Test1<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token builtin">help</span><span class="token punctuation">(</span>Test2<span class="token punctuation">)</span>
    test2 <span class="token operator">=</span> Test2<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>test2<span class="token punctuation">)</span>
  
<span class="token comment">#输出内容</span>
Help on <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token keyword">in</span> module __main__<span class="token punctuation">:</span>

<span class="token keyword">class</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span>Test<span class="token punctuation">)</span>
 <span class="token operator">|</span>  Method resolution order<span class="token punctuation">:</span>
 <span class="token operator">|</span>      Test1
 <span class="token operator">|</span>      Test
 <span class="token operator">|</span>      builtins<span class="token punctuation">.</span><span class="token builtin">object</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  Data descriptors inherited <span class="token keyword">from</span> Test<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __dict__
 <span class="token operator">|</span>      dictionary <span class="token keyword">for</span> instance variables <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __weakref__
 <span class="token operator">|</span>      <span class="token builtin">list</span> of weak references to the <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token operator">|</span>  Data <span class="token keyword">and</span> other attributes inherited <span class="token keyword">from</span> Test<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  age <span class="token operator">=</span> <span class="token number">18</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  name <span class="token operator">=</span> <span class="token string">'ZhangThree'</span>

<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Test1 <span class="token builtin">object</span> at <span class="token number">0x000000000292C4C8</span><span class="token operator">&gt;</span>
</code></pre></div><p>type接收一个元组包含类需要继承的父类</p></li> <li><p>type创建带有属性的类</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'zhangThree'</span>
    age <span class="token operator">=</span> <span class="token number">18</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token builtin">help</span><span class="token punctuation">(</span>Test1<span class="token punctuation">)</span> <span class="token comment">#查看类详细信息</span>
    test1 <span class="token operator">=</span> Test1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#常规创建类</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>test1<span class="token punctuation">)</span>

    Test2 <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Test2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'LiFour'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#type动态创建类</span>
    <span class="token builtin">help</span><span class="token punctuation">(</span>Test2<span class="token punctuation">)</span> <span class="token comment">#查看类详细信息</span>
    test2 <span class="token operator">=</span> Test2<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>test2<span class="token punctuation">)</span>

<span class="token comment">#输出内容</span>
Help on <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token keyword">in</span> module __main__<span class="token punctuation">:</span>

<span class="token keyword">class</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span>builtins<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">)</span>
 <span class="token operator">|</span>  Data descriptors defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __dict__
 <span class="token operator">|</span>      dictionary <span class="token keyword">for</span> instance variables <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __weakref__
 <span class="token operator">|</span>      <span class="token builtin">list</span> of weak references to the <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token operator">|</span>  Data <span class="token keyword">and</span> other attributes defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  age <span class="token operator">=</span> <span class="token number">18</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  name <span class="token operator">=</span> <span class="token string">'zhangThree'</span>

<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Test1 <span class="token builtin">object</span> at <span class="token number">0x00000000029B8208</span><span class="token operator">&gt;</span>
Help on <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token keyword">in</span> module __main__<span class="token punctuation">:</span>

<span class="token keyword">class</span> <span class="token class-name">Test2</span><span class="token punctuation">(</span>builtins<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">)</span>
 <span class="token operator">|</span>  Data descriptors defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __dict__
 <span class="token operator">|</span>      dictionary <span class="token keyword">for</span> instance variables <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __weakref__
 <span class="token operator">|</span>      <span class="token builtin">list</span> of weak references to the <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token operator">|</span>  Data <span class="token keyword">and</span> other attributes defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  age <span class="token operator">=</span> <span class="token number">20</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  name <span class="token operator">=</span> <span class="token string">'LiFour'</span>

<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Test2 <span class="token builtin">object</span> at <span class="token number">0x00000000029B81C8</span><span class="token operator">&gt;</span>
</code></pre></div><p>type接收一个字典包含类定义属性</p></li> <li><p>type创建带有方法的类</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">print_test</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---test---'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@staticmethod</span>
<span class="token keyword">def</span> <span class="token function">print_staticmethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---staticmethod---'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">print_classmethod</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---classmethod---'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    Test <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'LiFour'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span>
                            <span class="token string">'print_test'</span><span class="token punctuation">:</span>print_test<span class="token punctuation">,</span><span class="token string">'print_staticmethod'</span><span class="token punctuation">:</span>print_staticmethod<span class="token punctuation">,</span><span class="token string">'print_classmethod'</span><span class="token punctuation">:</span>print_classmethod<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#type动态创建类</span>
    <span class="token builtin">help</span><span class="token punctuation">(</span>Test<span class="token punctuation">)</span> <span class="token comment">#查看类详细信息</span>
    test <span class="token operator">=</span> Test<span class="token punctuation">(</span><span class="token punctuation">)</span>
    test<span class="token punctuation">.</span>print_test<span class="token punctuation">(</span><span class="token punctuation">)</span>    
    Test<span class="token punctuation">.</span>print_staticmethod<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Test<span class="token punctuation">.</span>print_classmethod<span class="token punctuation">(</span><span class="token punctuation">)</span>

   
<span class="token comment">#输出内容</span>
Help on <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">in</span> module __main__<span class="token punctuation">:</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span>builtins<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">)</span>
 <span class="token operator">|</span>  Methods defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  print_test<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token operator">|</span>  Class <span class="token class-name">methods</span> defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  print_classmethod<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> builtins<span class="token punctuation">.</span><span class="token builtin">type</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token operator">|</span>  Static methods defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  print_staticmethod<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token operator">|</span>  Data descriptors defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __dict__
 <span class="token operator">|</span>      dictionary <span class="token keyword">for</span> instance variables <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  __weakref__
 <span class="token operator">|</span>      <span class="token builtin">list</span> of weak references to the <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token keyword">if</span> defined<span class="token punctuation">)</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
 <span class="token operator">|</span>  Data <span class="token keyword">and</span> other attributes defined here<span class="token punctuation">:</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  age <span class="token operator">=</span> <span class="token number">20</span>
 <span class="token operator">|</span>
 <span class="token operator">|</span>  name <span class="token operator">=</span> <span class="token string">'LiFour'</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>test<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">staticmethod</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">classmethod</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
</code></pre></div><p>type接收一个字典包含类方法</p></li></ol></li> <li><p><strong>什么是元类</strong></p> <p>元类就是用来创建类的&quot;东西&quot;，简单来说元类就是类的类。在python中type实际上是一个元类，用于创建所有类的元类，比如str是用来创建字符串对象的类，而int是用来创建整数对象的类。type就是创建类对象的类。元类就是创建类这种对象的东西。type就是Python的内建元类，当然了，也可以创建自己的元类。</p> <ol><li><p>自定义元类</p> <p>自定义元类的目的，是为了能够当创建类的时候能够自动改变类。</p> <p>假想一个很傻的例子，本来已经有了一个类，里面属性名都是小写，突然某天想将类的属性改成大写，第一要么一个个改，第二要么使用元类。</p> <p>自定义元类主要使用<code>metaclass</code>属性，若不指定该属性，则选择用type元类来创建类，若指定，则选择用自定义元类来创建类。</p> <p>python3中</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">upper_attr</span><span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_parents<span class="token punctuation">,</span> class_attr<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment">#遍历属性字典，把不是__开头的属性名字变为大写</span>
    new_attr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> name<span class="token punctuation">,</span>value <span class="token keyword">in</span> class_attr<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;__&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            new_attr<span class="token punctuation">[</span>name<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> value

    <span class="token comment">#调用type来创建一个类</span>
    <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_parents<span class="token punctuation">,</span> new_attr<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>upper_attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    bar <span class="token operator">=</span> <span class="token string">'bip'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> <span class="token string">'BAR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

f <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>BAR<span class="token punctuation">)</span>
</code></pre></div><p>python2中</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">upper_attr</span><span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_parents<span class="token punctuation">,</span> class_attr<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># class_name 会保存类的名字 Foo</span>
    <span class="token comment"># class_parents 会保存类的父类 object</span>
    <span class="token comment"># class_attr 会以字典的方式保存所有的类属性</span>

    <span class="token comment"># 遍历属性字典，把不是__开头的属性名字变为大写</span>
    new_attr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> name<span class="token punctuation">,</span> value <span class="token keyword">in</span> class_attr<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;__&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            new_attr<span class="token punctuation">[</span>name<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> value

    <span class="token comment"># 调用type来创建一个类</span>
    <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_parents<span class="token punctuation">,</span> new_attr<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    __metaclass__ <span class="token operator">=</span> upper_attr <span class="token comment"># 设置Foo类的元类为upper_attr</span>
    bar <span class="token operator">=</span> <span class="token string">'bip'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> <span class="token string">'BAR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

f <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>BAR<span class="token punctuation">)</span>
</code></pre></div></li></ol></li></ul> <h2 id="异常机制"><a href="#异常机制" class="header-anchor">#</a> 异常机制</h2> <h3 id="异常与异常处理"><a href="#异常与异常处理" class="header-anchor">#</a> 异常与异常处理</h3> <ul><li><p>异常是指在程序运行过程中发生的错误。异常导致程序崩溃，并显示出现一些异常错误。</p> <p>python中常见的异常</p> <table><thead><tr><th>异常</th> <th>描述</th></tr></thead> <tbody><tr><td>NameError</td> <td>尝试访问一个没有声明的变量引发的错误</td></tr> <tr><td>IndexError</td> <td>索引超出序列范围引发的错误</td></tr> <tr><td>IndentationError</td> <td>缩进错误</td></tr> <tr><td>ValueError</td> <td>传入错误</td></tr> <tr><td>KeyError</td> <td>请求一个不存在的字典关键字引发的错误</td></tr> <tr><td>IOError</td> <td>输入输出错误（如要读取的文件不存在）</td></tr> <tr><td>ImportError</td> <td>当import语句无法找到模块或from 无法在模块中找到相应的名称时引发的错误</td></tr> <tr><td>AttributeError</td> <td>尝试访问未知的对象属性引发的错误</td></tr> <tr><td>TypeError</td> <td>类型不合适引发的错误</td></tr> <tr><td>MemoryError</td> <td>内存不足</td></tr> <tr><td>Exception</td> <td>常规错误的基类</td></tr></tbody></table></li> <li><p>异常处理是指在发生异常的时对异常进行捕获，然后处理，以避免程序直接崩溃。</p> <ol><li><p><strong>try...except</strong></p> <p>try...except语句捕获并处理异常。将有可能发生异常的代码放在try语句中，把发生异常时处理的代码放在except中，这样，当在try语句中发生异常的时候，就会执行except语句中的代码处理异常，如果try语句没有发生异常，就不会执行except语句。</p> <p>语法：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    block1    
<span class="token keyword">except</span> <span class="token punctuation">[</span>ExceptionName <span class="token punctuation">[</span><span class="token keyword">as</span> alias<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    block2
</code></pre></div><p>参数说明：</p> <ul><li>block1：表示可能出现错误的代码块。</li> <li>ExceptionName [as alias]:可选参数，用于指定要捕获的异常。其中，ExceptionName表示要捕获的异常名称，如果在其右侧加上as alias，则表示为当前的异常指定一个别名，通过该别名，可以记录异常的具体内容。如果在except后面不指定异常名称，则表示捕获全部异常。</li></ul> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'try...'</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    
<span class="token comment"># try...</span>
<span class="token comment"># except: division by zero</span>
</code></pre></div><p>在捕获异常时，如果需要捕获多个异常也可以在except后用小括号，将多个异常名称以逗号形式分割开。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'try...'</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token keyword">except</span> <span class="token punctuation">(</span>ZeroDivisionError<span class="token punctuation">,</span>ValueError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

<span class="token comment"># try...</span>
<span class="token comment"># except: division by zero</span>
</code></pre></div></li> <li><p><strong>try..except...else</strong></p> <p>try..except...else语句，在原来的基础上加else子句，表示当try语句中代码没有发现异常时执行的else中语句，若try语句中代码发现异常，则不执行。</p> <p>语法：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    block1    
<span class="token keyword">except</span> <span class="token punctuation">[</span>ExceptionName <span class="token punctuation">[</span><span class="token keyword">as</span> alias<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    block2
<span class="token keyword">else</span><span class="token punctuation">:</span>
    block3
</code></pre></div><p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'try...'</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token keyword">except</span> <span class="token punctuation">(</span>ZeroDivisionError<span class="token punctuation">,</span>ValueError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'安然无事...'</span><span class="token punctuation">)</span>

<span class="token comment"># try...</span>
<span class="token comment"># result: 5.0</span>
<span class="token comment"># 安然无事...</span>
</code></pre></div></li> <li><p><strong>try...except...finally</strong></p> <p>try...except...finally语句，在原来基础上加finally子句，表示无论程序是否有异常，finally语句中的代码都会执行。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span>：
    block1
<span class="token keyword">except</span> <span class="token punctuation">[</span>ExceptionName <span class="token punctuation">[</span><span class="token keyword">as</span> alias<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    block2
fianlly<span class="token punctuation">:</span>
    block3
</code></pre></div><p>说明：finally子句一般用于清理代码，资源释放（比如文件关闭）。</p> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'try...'</span><span class="token punctuation">)</span>
    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token keyword">except</span> <span class="token punctuation">(</span>ZeroDivisionError<span class="token punctuation">,</span>ValueError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'except:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'执行了一次数值运算'</span><span class="token punctuation">)</span>

<span class="token comment"># try...</span>
<span class="token comment"># except: division by zero</span>
<span class="token comment"># 执行了一次数值运算</span>
</code></pre></div></li></ol> <p>三种语句的执行流程</p> <p><img src="/AI/Python/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%E6%B5%81%E7%A8%8B.jpg" alt="异常处理机制流程"></p></li></ul> <h3 id="自定义异常类"><a href="#自定义异常类" class="header-anchor">#</a> 自定义异常类</h3> <p>python支持用户自定义异常，只要异常类继承了Error或者Exception类即可。</p> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyException</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''自定义的异常类'''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>message <span class="token operator">=</span> message
</code></pre></div><h3 id="主动抛出异常"><a href="#主动抛出异常" class="header-anchor">#</a> 主动抛出异常</h3> <p>除了能够将异常捕获，也能主动抛出异常，因为异常是具有传递性的，比如<code>函数A----&gt;函数B----&gt;函数C</code>,而异常是在函数C中产生的，那么如果函数C中没有对这个异常进行处理，那么这个异常会传递到函数B中，如果函数B有异常处理那么就会按照函数B的处理方式进行执行；如果函数B也没有异常处理，那么这个异常会继续传递，以此类推。。。如果所有的函数都没有处理，那么此时就会进行异常的默认处理，即程序异常退出，并显示异常信息。</p> <p>raise语句用于主动抛出异常。</p> <p>语法：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">raise</span> <span class="token punctuation">[</span>ExceptionName<span class="token punctuation">[</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>参数说明：</p> <ul><li>ExceptionName[(reason)]为可选参数，用于指定抛出的异常名称以及异常信息的相关描述。如果省略，就会把当前的错误原样抛出。</li></ul> <p>说明：ExceptionName[(reason)]参数中的“(reason)”也可以省略，如果省略，则在抛出异常时，不附带任何描述信息。</p> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyException</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''自定义的异常类'''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>message <span class="token operator">=</span> message
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> MyException<span class="token punctuation">(</span><span class="token string">'发生了自定义异常'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> MyException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'没有发生异常'</span><span class="token punctuation">)</span>
<span class="token comment">#发生了自定义异常</span>
</code></pre></div><p>具体可参考<a href="https://www.cnblogs.com/ooo888ooo/p/10360656.html" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="多任务"><a href="#多任务" class="header-anchor">#</a> 多任务</h2> <p>多任务即操作系统可以同时执行多个任务，即同时处理任务，而不是等待前一个完成再处理下一个，比如我们可以一边听音乐，一边写Word，一边看新闻等这样的行为就是多任务。</p> <p>在现在，一般的电脑都是多核CPU，基本上都可以实现多任务，就是每个CPU里同一时刻处理不同的任务，一般而言任务数都是大于CPU核数，操作系统通过任务调度的方式轮流将任务安排到每个核心中执行。即使是单核CPU也能执行多任务，操作系统轮流让每一个任务交替执行，任务1执行0.01秒，切换到任务2，任务2执行0.01秒，再切换到任务3，执行0.01秒……这样反复执行下去。表面上看，每个任务都是交替执行的，但是，由于CPU的执行速度实在是太快了，我们感觉就像所有任务都在同时执行一样。</p> <p>任务执行状态如下图</p> <p><img src="/AI/Python/%E5%A4%9A%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E7%8A%B6%E6%80%81.png" alt="多任务执行状态"></p> <ul><li>就绪态：处于就绪队列中，等待CPU执行任务</li> <li>执行态：CPU正在执行任务</li> <li>等待态：发生堵塞，需要等待某些条件满足才能恢复就绪态</li></ul> <p>多任务中关键的两个概念的简单解释</p> <ul><li>并发：指的是任务数多余CPU核数，通过操作系统的各种任务调度算法，实现用多个任务“一起”执行（实际上总有一些任务不在执行，因为切换任务的速度相当快，看上去一起执行而已）</li> <li>并行：指的是任务数小于等于CPU核数，即任务真的是一起执行的</li></ul> <p>在python里实现多任务的方式有三种，进程，线程和协程。</p> <h3 id="进程"><a href="#进程" class="header-anchor">#</a> 进程</h3> <p>进程也是python实现多任务手段之一。进程是资源分配的单位。比如某个python文件是代码程序，是一个静态的，在一个程序运行起来后，代码程序+分配资源称之为进程。</p> <p>若在程序里，我们想实现一边看剧一边吃零食的场景，那么如果是单进程则是这样情况。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    watch<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#看电视</span>
    eat<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#吃零食</span>

正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div><p>说明：可以看到，在单进程下，先执行watch，再执行eat，也就是要看完电视，才能吃零食。</p> <h4 id="多进程实现"><a href="#多进程实现" class="header-anchor">#</a> 多进程实现</h4> <ul><li><p>multiprocessing</p> <p>python的multiprocessing模块是实现多进程的实现方式之一。在多进程下实现边看电视，边吃零食。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    p1 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">)</span>
    p2 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">)</span>
    p1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div><p>说明：实例化multiprocessing模块中Process类，并将target指定为需要执行的函数，通过调用实例对象p1,p2的start方法启动子进程。</p> <p>若想要查看进程，可以通过<code>os.getpid()</code>方法查看当前进程号</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'看电视子进程号%s'</span><span class="token operator">%</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'看吃零食子进程号%s'</span><span class="token operator">%</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'看主进程号%s'</span><span class="token operator">%</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p1 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">)</span>
    p2 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">)</span>
    p1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
   
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
看主进程号<span class="token number">4368</span>
看吃零食子进程号<span class="token number">11640</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
看电视子进程号<span class="token number">14736</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div><p>若想要进程里传参，有三种方式</p> <ol><li>使用元组传递 Process(target=方法名，args=（参数1,参数2, ...）)</li> <li>使用字典传递 Process(target=方法名, kwargs={&quot;参数名&quot;: 参数1, &quot;参数名&quot;: 参数2, ...})</li> <li>混合使用元组和字典 Process(target=方法名，args=（参数1, 参数2, ...）, kwargs={&quot;参数名&quot;: 参数1,&quot;参数名&quot;: 参数2, ...})</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s正在看电视...%d&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s正在吃零食...%d&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    p1 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'小王'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    p2 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'小王'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    p1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token number">2</span>
小王正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
<span class="token number">1</span> <span class="token number">2</span>
小王正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
小王正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
小王正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
小王正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
小王正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div></li></ul> <h4 id="多进程通信"><a href="#多进程通信" class="header-anchor">#</a> 多进程通信</h4> <p>主进程创建子进程后，每一个进程都是在内存中独立存在，简单来说，就是将主进程中代码和资源拷贝一份，然后运行代码中指定部分。所以在进程间是不共享全局变量。若想要在进程之间通信，需要使用消息队列机制。</p> <ul><li><p>Queue</p> <p>multiprocessing模块的Queue实现多进程之间的数据传递，Queue本身是一个消息列队程序。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Queue

<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#初始化Queue对象，最多可接受三个消息</span>
    <span class="token comment">#put 放入消息</span>
    q<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    q<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    q<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token comment">#get 取出消息</span>
    msg1 <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span>
    msg2 <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>msg2<span class="token punctuation">)</span>
    msg3 <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>msg3<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#初始化Queue对象，最多可接受三个消息</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">#放入消息</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> q<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment">#先判断消息队列是否已经满，再写入</span>
            q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    
    <span class="token comment">#取出消息</span>
    <span class="token comment"># while True:</span>
    <span class="token comment">#     if not q.empty():</span>
    <span class="token comment">#         #先判断消息队列是否为空，再取出</span>
    <span class="token comment">#         print(q.get())</span>
    <span class="token comment">#     else:</span>
    <span class="token comment">#         break</span>
    
    <span class="token comment">#取出消息</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    f1<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 1</span>
    <span class="token comment"># 2</span>
    <span class="token comment"># 3</span>
    f2<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 0</span>
    <span class="token comment"># 1</span>
    <span class="token comment"># 2</span>
</code></pre></div><p>说明：</p> <p>初始化Queue()对象时（例如：q=Queue()），若括号中没有指定最大可接收的消息数量，或数量为负值，那么就代表可接受的消息数量没有上限（直到内存的尽头）。</p> <ul><li>Queue.qsize()：返回当前队列包含的消息数量；</li> <li>Queue.empty()：如果队列为空，返回True，反之False ；</li> <li>Queue.full()：如果队列满了，返回True,反之False；</li> <li>Queue.get([block[, timeout]])：获取队列中的一条消息，然后将其从列队中移除，block默认值为True；
<ul><li>如果block使用默认值，且没有设置timeout（单位秒），消息列队如果为空，此时程序将被阻塞（停在读取状态），直到从消息列队读到消息为止，如果设置了timeout，则会等待timeout秒，若还没读取到任何消息，则抛出&quot;Queue.Empty&quot;异常；</li> <li>如果block值为False，消息列队如果为空，则会立刻抛出&quot;Queue.Empty&quot;异常；</li></ul></li> <li>Queue.get_nowait()：相当Queue.get(False)；</li> <li>Queue.put(item,[block[, timeout]])：将item消息写入队列，block默认值为True；
<ul><li>如果block使用默认值，且没有设置timeout（单位秒），消息列队如果已经没有空间可写入，此时程序将被阻塞（停在写入状态），直到从消息列队腾出空间为止，如果设置了timeout，则会等待timeout秒，若还没空间，则抛出&quot;Queue.Full&quot;异常；</li> <li>如果block值为False，消息列队如果没有空间可写入，则会立刻抛出&quot;Queue.Full&quot;异常；</li></ul></li> <li>Queue.put_nowait(item)：相当Queue.put(item, False)；</li></ul> <p>以Queue为例，在父进程中创建两个子进程，一个往Queue里写数据，一个从Queue里读数据</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Queue<span class="token punctuation">,</span>Process
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">putMsg</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Put %s to queue...'</span><span class="token operator">%</span>value<span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getMsg</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            value <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Get %s from queue...'</span><span class="token operator">%</span>value<span class="token punctuation">)</span>
            <span class="token comment">#time.sleep(1)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'队列已无消息'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        
Put A to queue<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Get A <span class="token keyword">from</span> queue<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Put B to queue<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Get B <span class="token keyword">from</span> queue<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Put C to queue<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Get C <span class="token keyword">from</span> queue<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
队列已无消息
</code></pre></div></li></ul> <h4 id="进程池"><a href="#进程池" class="header-anchor">#</a> 进程池</h4> <p>当需要创建大量子进程时，若考虑手动创建，不仅工作量大，而且对内存和CPU造成大量压力，因为一次性创建大量子进程，可能导致内存崩溃等问题，同时子进程的创建和销毁也是需要耗费时间，如果没有一个机制去维护的话，会浪费大量资源。</p> <p>我们可以使用进程池避免上述问题，在进程池中可以指定最大进程数，当有新的请求提交到池中时，如果池中进程还没有满，那么就会创建一个新的进程来执行请求；但如果池中的进程数已经达到指定的最大值，那么该请求就会等待，直接进程池中有进程结束，才会用之前的进程来执行新的请求。</p> <ul><li><p>Pool</p> <p>multiprocessing模块的Pool实现进程池的管控。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;第%s子进程开始执行,进程号为%d&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;第%s子进程结束执行,进程号为%d&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    po <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#创建进程池，最大进程数3</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 利用进程池执行子进程，若进程池空闲则去调用子进程</span>
        po<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>worker<span class="token punctuation">,</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    po<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 关闭进程池，关闭后po不再接收新的请求</span>
    po<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 主进程等待po中所有子进程执行完成，必须放在close语句之后</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---结束---'</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
第<span class="token number">0</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
第<span class="token number">1</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">12396</span>
第<span class="token number">2</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">1416</span>
第<span class="token number">0</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
第<span class="token number">3</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
第<span class="token number">1</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">12396</span>
第<span class="token number">4</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">12396</span>
第<span class="token number">2</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">1416</span>
第<span class="token number">5</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">1416</span>
第<span class="token number">3</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
第<span class="token number">6</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
第<span class="token number">4</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">12396</span>
第<span class="token number">7</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">12396</span>
第<span class="token number">5</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">1416</span>
第<span class="token number">8</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">1416</span>
第<span class="token number">6</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
第<span class="token number">9</span>子进程开始执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
第<span class="token number">7</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">12396</span>
第<span class="token number">8</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">1416</span>
第<span class="token number">9</span>子进程结束执行<span class="token punctuation">,</span>进程号为<span class="token number">8748</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>结束<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
</code></pre></div><p>说明：</p> <ul><li>apply_async(func[, args[, kwds]]) ：使用非阻塞方式调用func（并行执行），args为传递给func的参数列表，kwds为传递给func的关键字参数列表；</li> <li>apply(func[, args[, kwds]]) ：使用堵塞方式调用func（必须等待上一个进程退出才能执行下一个进程），args为传递给func的参数列表，kwds为传递给func的关键字参数列表；</li> <li>close()：关闭Pool，使其不再接受新的任务；</li> <li>terminate()：不管任务是否完成，立即终止；</li> <li>join()：主进程阻塞，等待子进程的退出， 必须在close或terminate之后使用；</li></ul></li></ul> <h3 id="线程"><a href="#线程" class="header-anchor">#</a> 线程</h3> <p>线程是python实现多任务的手段之一。线程是操作系统调度的单位。线程依托于进程，在每一个进程里至少有一个线程存在，负责调度进程中各种资源，执行任务。比如打开Word进程，在Word里一个线程负责输入内容，另一个线程负责对内容进行编辑，还要线程负责内容排版等，通过多线程的方式完成各种任务。</p> <h4 id="多线程实现"><a href="#多线程实现" class="header-anchor">#</a> 多线程实现</h4> <ul><li><p>threading模块</p> <p>python的threading模块是实现多线程的实现方式之一。在多线程下实现边看电视，边吃零食。</p> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> threading

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div><p>说明：实例化threading模块中Thread类，并将target指定为需要执行的函数，通过调用实例对象t1,t2的start方法启动子线程。</p> <p>之前说过在进程中至少有一个线程存在，这个线程就是指主线程，而其他新开启的线程我们称为子线程。一般来说主线程执行完自己的任务后就会退出，此时子线程会继续执行自己的任务，直到结束。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> threading

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---结束---'</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>结束<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div><p>说明：可以看到，主线程先打印<code>---开始---</code>，实例化两个子线程并启动，然后打印<code>---结束---</code>，这时候主线程完成了自己的任务退出了，两个子线程依然在执行自己的任务，直到任务结束退出。</p> <p>若想要主线程退出，子线程也强制退出的话。需要设置子线程一个参数Daemon，当其值为True的话，这样的子线程称为守护线程，一般情况默认为False。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> threading

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>setDaemon<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>setDaemon<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#sleep(5)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---结束---'</span><span class="token punctuation">)</span>
 
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>结束<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
</code></pre></div><p>说明：在子线程为守护线程的情况下，主线程退出后，子线程也会强制的退出。</p> <p>若想查看线程的数量，可以调用<code>threading.enumerate()</code>方法来获取，返回值是当前进程中所有线程的列表。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> threading

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'当前运行的线程数为：%d'</span><span class="token operator">%</span>length<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'当前线程名称为:%s'</span><span class="token operator">%</span><span class="token builtin">str</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> length<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---结束---'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
当前运行的线程数为：<span class="token number">3</span>
当前线程名称为<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">12316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">5840</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">16800</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
当前运行的线程数为：<span class="token number">3</span>
当前线程名称为<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">12316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">5840</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">16800</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
当前运行的线程数为：<span class="token number">3</span>
当前线程名称为<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">12316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">5840</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">16800</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.3</span>
当前运行的线程数为：<span class="token number">2</span>
当前线程名称为<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">12316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">5840</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.4</span>
当前运行的线程数为：<span class="token number">2</span>
当前线程名称为<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">12316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Thread<span class="token punctuation">(</span>Thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">5840</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
当前运行的线程数为：<span class="token number">1</span>
当前线程名称为<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread<span class="token punctuation">,</span> started <span class="token number">12316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>结束<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
</code></pre></div><p>说明：可以看到MainThread就是我们所说的主线程，而Thread-1，Thread-2为创建的子线程，若不为子线程命名的话，python会自动为线程取名。</p> <p>若想要线程里传参，有三种方式</p> <ol><li>使用元组传递 threading.Thread(target=方法名，args=（参数1,参数2, ...）)</li> <li>使用字典传递 threading.Thread(target=方法名, kwargs={&quot;参数名&quot;: 参数1, &quot;参数名&quot;: 参数2, ...})</li> <li>混合使用元组和字典 threading.Thread(target=方法名，args=（参数1, 参数2, ...）, kwargs={&quot;参数名&quot;: 参数1,&quot;参数名&quot;: 参数2, ...})</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> threading

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s正在看电视...%d&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s正在吃零食...%d&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---开始---'</span><span class="token punctuation">)</span>
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>watch<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'小王'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>eat<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'小王'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---结束---'</span><span class="token punctuation">)</span>
    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>开始<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token number">2</span>
小王正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
<span class="token number">1</span> <span class="token number">2</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>结束<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
小王正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
小王正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
小王正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
小王正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
小王正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div></li> <li><p>继承threading.Thread类</p> <p>除了直接实例化Thread类，我们还可以通过继承的方式实现多线程，这样让每一个线程的具有封装性。</p> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;I'm &quot;</span><span class="token operator">+</span>self<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">' @ '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">#name属性中保存的是当前线程的名字</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> MyThread<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> MyThread<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
I'm Thread<span class="token operator">-</span><span class="token number">1</span> @ <span class="token number">0</span>
I'm Thread<span class="token operator">-</span><span class="token number">2</span> @ <span class="token number">0</span>
I'm Thread<span class="token operator">-</span><span class="token number">1</span> @ <span class="token number">1</span>
I'm Thread<span class="token operator">-</span><span class="token number">2</span> @ <span class="token number">1</span>
I'm Thread<span class="token operator">-</span><span class="token number">1</span> @ <span class="token number">2</span>
I'm Thread<span class="token operator">-</span><span class="token number">2</span> @ <span class="token number">2</span>
</code></pre></div><p>说明：通过继承threading.Thread类，并重写<code>run</code>方法，然后创建自己的线程实例后，通过调用<code>start</code>方法（注意不是调用<code>run</code>方法），启动子线程，这样当子线程获取执行机会的时，就会调用run方法。若要传参，可以通过构造函数的方式。</p></li></ul> <h4 id="多线程共享全局变量"><a href="#多线程共享全局变量" class="header-anchor">#</a> 多线程共享全局变量</h4> <ul><li><p>共享全局变量</p> <p>在一个进程中所有的线程共享全局变量，这样方便线程之间通信。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">import</span> time

g_num <span class="token operator">=</span> <span class="token number">100</span>

<span class="token keyword">def</span> <span class="token function">work1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> g_num
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        g_num <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;----in work1, g_num is %d---&quot;</span><span class="token operator">%</span>g_num<span class="token punctuation">)</span>
  
<span class="token keyword">def</span> <span class="token function">work2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> g_num
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;----in work2, g_num is %d---&quot;</span><span class="token operator">%</span>g_num<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;---线程创建之前g_num is %d---&quot;</span><span class="token operator">%</span>g_num<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>work1<span class="token punctuation">)</span>

    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#延时一会，保证t1线程中的事情做完</span>

    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>work2<span class="token punctuation">)</span>

    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>线程创建之前g_num <span class="token keyword">is</span> <span class="token number">100</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">in</span> work1<span class="token punctuation">,</span> g_num <span class="token keyword">is</span> <span class="token number">103</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">in</span> work2<span class="token punctuation">,</span> g_num <span class="token keyword">is</span> <span class="token number">103</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>

</code></pre></div><p>说明：在t1线程中，对全局变量g_num操作，在t2线程中读取全局变量g_num，可以发现全局变量是在线程中共享的。</p></li> <li><p>线程安全问题</p> <p>线程对全局变量的操作会引起线程安全问题。</p> <p>现模拟卖票系统，有三个卖票窗口同时出售30张票，在每次卖票之前需要花费一定的时间咨询客户目的地。</p></li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">TicketSystem</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ticket_number <span class="token operator">=</span> <span class="token number">30</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>TicketSystem<span class="token punctuation">.</span>ticket_number<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token comment">#模拟咨询客户过程所耗费时间</span>
                TicketSystem<span class="token punctuation">.</span>ticket_number<span class="token operator">-=</span><span class="token number">1</span> <span class="token comment">#模拟卖票</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s 窗台卖票，目前还剩%d张票'</span><span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span>TicketSystem<span class="token punctuation">.</span>ticket_number<span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
      
          
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> TicketSystem<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#窗口1</span>
    t2 <span class="token operator">=</span> TicketSystem<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#窗口2</span>
    t3 <span class="token operator">=</span> TicketSystem<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#窗口3</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t3<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
     

  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">29</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">28</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">27</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">26</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">25</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">24</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">23</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">22</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">21</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">20</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">19</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">18</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">17</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">16</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">15</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">14</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">13</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">12</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">11</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">10</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">9</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">8</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">7</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">6</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">5</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">4</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">3</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">2</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">1</span>张票
  Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">0</span>张票
  Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token operator">-</span><span class="token number">1</span>张票
  Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token operator">-</span><span class="token number">2</span>张票
</code></pre></div><p>说明：我们看到三个窗台出售30张票时，出现了剩余负数票的情况，导致这种原因主要是因为多线程同时对同一个全局变量进行操作过程中，出现了资源竞争的问题。比如，当出售第30张票时，Thread-1线程判断当前是否还剩余票，Thread-1发现还剩1张（if判断，ticket_number&gt;0），然后开始咨询客户目的地（进行休眠）。此时Thread-2在Thread-1休眠期间得到得到CPU调度，判断当前是否还有剩余票，由于Thread-1还休眠还未结束，此时Thread-1对票数还未减1，Thread-2发现也还剩1张（if判断，ticket_number&gt;0），然后进行休眠（开始咨询客户目的地）。同理Thread-3也由于同样情况，进入到售票环节。接着Thread-1开始售票（休眠结束），将剩余最后1张票卖出（TicketSystem.ticket_number-=1）；然后Thread-2也开始售票（休眠结束），但是Thread-2在卖票数时，是在Thread-1卖完最后1张票基础上减1，即0-1=-1；Thread-3也同理，在Thread-2基础上减1，即-1-1=-2。所以出现了剩余负票的情况。</p> <h4 id="多线程的锁"><a href="#多线程的锁" class="header-anchor">#</a> 多线程的锁</h4> <p>解决线程安全问题，主要利用锁的机制，让线程对全局变量操作过程具有原子性，即要么都做要么都不做，维持线程同步。</p> <ul><li><p>互斥锁</p> <p>互斥锁即最简单的同步机制。互斥锁为每一个线程赋予锁定和非锁定状态。当某个线程要更改共享数据时，先将其锁定，此时资源的状态为“锁定”，其他线程不能更改；直到该线程释放资源，将资源的状态变成“非锁定”，其他的线程才能再次锁定该资源。互斥锁保证了每次只有一个线程进行写入操作，从而保证了多线程情况下数据的正确性。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">TicketSystem</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    ticket_number <span class="token operator">=</span> <span class="token number">30</span>
    
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token comment">#避免总是同一线程运行</span>
            mutex<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#上锁</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>TicketSystem<span class="token punctuation">.</span>ticket_number<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token comment">#模拟咨询客户过程所耗费时间</span>
                TicketSystem<span class="token punctuation">.</span>ticket_number<span class="token operator">-=</span><span class="token number">1</span>  <span class="token comment">#模拟卖票</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s 窗台卖票，目前还剩%d张票'</span><span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span>TicketSystem<span class="token punctuation">.</span>ticket_number<span class="token punctuation">)</span><span class="token punctuation">)</span>
            mutex<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 解锁</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>TicketSystem<span class="token punctuation">.</span>ticket_number<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            
    
mutex <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#创建互斥锁</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    
    t1 <span class="token operator">=</span> TicketSystem<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> TicketSystem<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t3 <span class="token operator">=</span> TicketSystem<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t3<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
  
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">29</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">28</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">27</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">26</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">25</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">24</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">23</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">22</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">21</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">20</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">19</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">18</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">17</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">16</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">15</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">14</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">13</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">12</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">11</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">10</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">9</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">8</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">7</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">6</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">5</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">4</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">3</span>张票
Thread<span class="token operator">-</span><span class="token number">2</span> 窗台卖票，目前还剩<span class="token number">2</span>张票
Thread<span class="token operator">-</span><span class="token number">3</span> 窗台卖票，目前还剩<span class="token number">1</span>张票
Thread<span class="token operator">-</span><span class="token number">1</span> 窗台卖票，目前还剩<span class="token number">0</span>张票
</code></pre></div><p>说明：在售票环节期间加上互斥锁，在每一次售票前上锁，让其他线程无法进入干扰，然后进行售票，结束后释放锁。保证每一次售票操作的原子性。</p></li> <li><p>死锁问题</p> <p>虽然加上锁之后，多线程共享全局变量的问题能得到很好的解决，但是锁的引入本来也来带许多问题，其中问题之一就是死锁问题。</p> <p>在线程间共享多个资源的时候，如果两个线程分别占有一部分资源并且同时等待对方的资源，就会造成死锁。尽管死锁很少发生，但一旦发生就会造成应用的停止响应。</p> <p>实例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">MyThread1</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mutexA<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#上锁A</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s ---do1---'</span><span class="token operator">%</span>self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># mutexA上锁后，延时1秒，等待另外那个线程 把mutexB上锁</span>
        mutexB<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#上锁B</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s ---do2---'</span><span class="token operator">%</span>self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        mutexB<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#解锁B</span>
        mutexA<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#解锁A</span>
        

<span class="token keyword">class</span> <span class="token class-name">MyThread2</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mutexB<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#上锁B</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s ---do1---'</span><span class="token operator">%</span>self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># mutexB上锁后，延时1秒，等待另外那个线程 把mutexA上锁</span>
        mutexA<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#上锁A</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s ---do2---'</span><span class="token operator">%</span>self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        mutexA<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#解锁A</span>
        mutexB<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#解锁B</span>


mutexA <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#锁A</span>
mutexB <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#锁B</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> MyThread1<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> MyThread2<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
  
Thread<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>do1<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Thread<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>do1<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
</code></pre></div><p>说明：在运行后会发现，程序陷入了死锁状态，因为在Thread-1中，获取了锁A，然后进入休眠状态，Thread-2得到CPU调度，获取了锁B，也进入休眠状态。此时Thread-1恢复调度，需要锁B，但是锁B被Thread-2占用，Thread-2恢复调度，需要锁A，但锁A被Thread-1占用，程序陷入了锁A等待锁B释放，锁B等待锁A释放的状态，两把锁僵持住了，即死锁。</p></li> <li><p>GIL（全局解释锁）</p> <p>GIL即全局解释锁的简称，其本身与python语言没关系，主要是由于Cpython虚拟机（解释器）的<a href="http://www.artima.com/forums/flat.jsp?forum=106&amp;thread=214235" target="_blank" rel="noopener noreferrer">历史原因<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>遗留下来的东西。</p> <p>GIL对python的影响主要是，在python中每一个线程在执行的过程中都要先获取GIL，保证同一时刻只有一个线程可执行，即导致python中的多线程其实是&quot;假的多线程&quot;。可以同过死循环+CPU执行状态查看来验证。</p> <p>GIL在线程遇到IO操作时，由于堵塞，会暂时释放GIL锁，等堵塞结束后再获取GIL锁。所以对于python中遇到IO密集型操作时，使用多线程比单线程效率高。</p> <p>GIL的移除方式有两种。第一切换底层Cpython虚拟机（解释器），比如换Java写的Jython虚拟机（解释器）；第二在python多线程操作代码，使用其他语言实现（Java，C/C++等），然后再在python中调用。</p></li></ul> <h4 id="进程和线程的区别"><a href="#进程和线程的区别" class="header-anchor">#</a> 进程和线程的区别</h4> <ol><li>进程是操作系统资源分配的单位，线程是操作系统调度的单位</li> <li>每个程序至少有一个进程，每一个进程中至少有一个线程，进程不能单独执行，必须依存在进程中</li> <li>多线程之间共享内存，多进程之间拥有独立内存单元，不能共享内存</li> <li>在考虑GIL下，进程才算是真正的多任务并行，线程是“假的多任务并行”</li> <li>多进程适合计算密集型程序，多线程适合IO密集型程序</li></ol> <p>若将进程理解为工厂中流水线的话，线程就是流水线上的工人</p> <h3 id="协程"><a href="#协程" class="header-anchor">#</a> 协程</h3> <p>协程，又称微线程，是另一种实现多线程的方式，比线程耗费资源更新的执行单位。简单来说就是在一个线程中的某个函数，可以在任何地方保存当前函数的一些临时变量等信息，然后切换到另外一个函数中执行，注意不是通过调用函数的方式做到的，并且切换的次数以及什么时候再切换到原来的函数都由开发者自己确定。</p> <h4 id="多协程实现"><a href="#多协程实现" class="header-anchor">#</a> 多协程实现</h4> <ul><li><p>yield</p> <p>简单利用yield关键字可以实现协程。在多协程下边看电视，边吃零食。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

  <span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
          <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
          <span class="token keyword">yield</span>
          sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
      <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
          <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
          <span class="token keyword">yield</span>
          sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 

  <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
      w <span class="token operator">=</span> watch<span class="token punctuation">(</span><span class="token punctuation">)</span>
      e <span class="token operator">=</span> eat<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
          <span class="token keyword">try</span><span class="token punctuation">:</span>
              <span class="token builtin">next</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span>
              <span class="token builtin">next</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
          <span class="token keyword">except</span> StopIteration <span class="token keyword">as</span> e<span class="token punctuation">:</span>
              <span class="token keyword">break</span>
          
  正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
  正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
  正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
  正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
  正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
  正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div></li> <li><p>greenlet</p> <p>为了更好使用协程来完成多任务，python中的greenlet模块对其封装，从而使得切换任务变的更加简单。先需要安装greenlet模块。</p> <div class="language-python extra-class"><pre class="language-python"><code>pip install greenlet
conda install greenlet
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">from</span> greenlet <span class="token keyword">import</span> greenlet

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        gr2<span class="token punctuation">.</span>switch<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        gr1<span class="token punctuation">.</span>switch<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    gr1 <span class="token operator">=</span> greenlet<span class="token punctuation">(</span>watch<span class="token punctuation">)</span>
    gr2 <span class="token operator">=</span> greenlet<span class="token punctuation">(</span>eat<span class="token punctuation">)</span>

    <span class="token comment">#切换到watch运行</span>
    gr1<span class="token punctuation">.</span>switch<span class="token punctuation">(</span><span class="token punctuation">)</span>

正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div></li> <li><p>gevent</p> <p>greenlet虽然封装了协程，但是还是需要人工切换，在python里能使用一个更加强大且自动化切换任务模块gevent。先需要安装gevent模块。</p> <div class="language-python extra-class"><pre class="language-python"><code>pip install gevent
conda install gevent
</code></pre></div><p>其原理是当一个协程遇到IO(指的是input output 输入输出，比如网络、文件操作等)操作时，比如访问网络，就自动切换到其他的协程，等到IO操作完成，再在适当的时候切换回来继续执行。</p> <p>由于IO操作非常耗时，经常使程序处于等待状态，有了gevent为我们自动切换协程，就保证总有协程在运行，而不是等待IO。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> gevent
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        
        <span class="token comment">#用来模拟一个耗时操作，注意不是time模块中的sleep</span>
        gevent<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        
        <span class="token comment">#用来模拟一个耗时操作，注意不是time模块中的sleep</span>
        gevent<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    g1 <span class="token operator">=</span> gevent<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span>watch<span class="token punctuation">)</span>
    g2 <span class="token operator">=</span> gevent<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span>eat<span class="token punctuation">)</span>
    g1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    g2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
   
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div><p>注意：这个有一个问题，就是必须使用gevent里耗时操作，为了解决这个问题，我们可以使用给程序打补丁的方式解决。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> gevent <span class="token keyword">import</span> monkey
monkey<span class="token punctuation">.</span>patch_all<span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token keyword">import</span> gevent
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
 

<span class="token keyword">def</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在看电视...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;正在吃零食...%d&quot;</span><span class="token operator">%</span>i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># 将程序中用到的耗时操作的代码，换为gevent中自己实现的模块</span>
    
    gevent<span class="token punctuation">.</span>joinall<span class="token punctuation">(</span><span class="token punctuation">[</span>
        gevent<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span>watch<span class="token punctuation">)</span><span class="token punctuation">,</span>
        gevent<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span>eat<span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.1</span>
正在看电视<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
正在吃零食<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.2</span>
</code></pre></div></li></ul> <h4 id="进程，线程和协程区别"><a href="#进程，线程和协程区别" class="header-anchor">#</a> 进程，线程和协程区别</h4> <ol><li>进程是资源分配的单位，线程是系统调度的单位，协程比线程更小调度单位。</li> <li>进程切换需要切换需要耗费大量资料，效率低；线程切换资源一般���效率一般（不考虑GIL下）；协程切换资源小，效率高。</li> <li>多进程、多线程根据cpu核数不一样可能是并行的，但是协程是在一个线程中所以是并发</li></ol> <p>通俗理解三者</p> <ul><li>有一个老板想要开个工厂进行生产某件商品（例如剪子）</li> <li>他需要花一些财力物力制作一条生产线，这个生产线上有很多的器件以及材料这些所有的 为了能够生产剪子而准备的资源称之为：进程</li> <li>只有生产线是不能够进行生产的，所以老板的找个工人来进行生产，这个工人能够利用这些材料最终一步步的将剪子做出来，这个来做事情的工人称之为：线程</li> <li>这个老板为了提高生产率，想到3种办法：
<ol><li>在这条生产线上多招些工人，一起来做剪子，这样效率是成倍増长，即<code>单进程 多线程</code>方式</li> <li>老板发现这条生产线上的工人不是越多越好，因为一条生产线的资源以及材料毕竟有限，所以老板又花了些财力物力购置了另外一条生产线，然后再招些工人这样效率又再一步提高了，即<code>多进程 多线程</code>方式</li> <li>老板发现，现在已经有了很多条生产线，并且每条生产线上已经有很多工人了（即程序是多进程的，每个进程中又有多个线程），为了再次提高效率，老板想了个损招，规定：如果某个员工在上班时临时没事或者再等待某些条件（比如等待另一个工人生产完谋道工序 之后他才能再次工作） ，那么这个员工就利用这个时间去做其它的事情，那么也就是说：如果一个线程等待某些条件，可以充分利用这个时间去做其它事情，其实这就是：<code>协程</code>方式</li></ol></li></ul> <h2 id="网络编程"><a href="#网络编程" class="header-anchor">#</a> 网络编程</h2> <h2 id="数据库操作"><a href="#数据库操作" class="header-anchor">#</a> 数据库操作</h2> <h2 id="常用第三方模块"><a href="#常用第三方模块" class="header-anchor">#</a> 常用第三方模块</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time"> 2020 九月 4日 10:56:40</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/AI/Python/python-oo.html" class="prev">
        Python面向对象
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.02e74a2b.js" defer></script><script src="/assets/js/2.57c6d2f7.js" defer></script><script src="/assets/js/34.cb778d11.js" defer></script>
  </body>
</html>
